var Format = function() {
	var _adventureNode = function(node) {
		return {
			id: _graphID(node.self),
			title: node.data.title || ''
		};
	};

	var _tagNode = function(node) {
		return {
			id: _graphID(node.self),
			title: node.data.tag || ''
		};
	};

	var _userNode = function(node) {
		return {
			id: _graphID(node.self),
			title: node.data.username || ''
		};
	};

	var _adventures = function(adventures) {
		var i,
			j,
			results = [];
		
		for(i=0, j=adventures.length; i<j; i++){
			results.push( _adventureNode( adventures[i] ) );
		}

		return results;
	};

	var _comment = function(commentVertex, commentEdge) {
		return {
			author: _user(commentVertex),
			comment: {
				text: commentEdge.data.text,
				date: commentEdge.data.date,
				id: _graphID(commentEdge.self)
			}
		};
	};

	var _comments = function(comments) {
		var i,
			j,
			results = [];
		
		for(i=0, j=comments.length; i<j; i++){
			results.push( _comment( comments[i][0], comments[i][1] ) );
		}

		return results;
	};

	var _graphID = function(nodeUrl) {
		return (typeof nodeUrl === 'string') ? nodeUrl.split('/').pop() : null;
	};

	var _like = function(likeVertex, likeEdge) {
		return {
			author: _user(likeVertex),
			like: {
				value: likeEdge.data.value,
				id: _graphID(likeEdge.self)
			}
		};
	};

	var _likes = function(likes) {
		var i,
			j,
			results = [];
		
		for(i=0, j=likes.length; i<j; i++){
			results.push( _like( likes[i][0], likes[i][1] ) );
		}

		return results;
	};

	var _moment = function(momentNode) {
		var moment = momentNode[0],
			creator = _user( momentNode[1] ),
			comments = _comments( momentNode[2] ),
			likes = _likes( momentNode[3] ),
			tags = _tags( momentNode[4] ),
			users = _users( momentNode[5] );

		// console.log(_graphID(moment.self) + ' likes ' + likes.length);
		// console.log(_graphID(moment.self) + ' comments ' + comments.length);

		return {
			id: _graphID(moment.self),
			imageUrl: moment.data.imageUrl,
			creator: creator,
			comments: comments,
			likes: likes,
			tags: tags,
			users: users
		};
	};

	var _moments = function(moments) {
		var i,
			j,
			results = [];

			for(i=0, j=moments.length; i<j; i++){
			results.push( _moment( moments[i] ) );
		}

		return results;
	};

	var _tag = function(tag) {
		return {
			id: _graphID(tag.self),
			title: tag.data.tag
		};
	};

	var _tags = function(tags) {
		var i,
			j,
			results = [];
		
		for(i=0, j=tags.length; i<j; i++){
			results.push( _tag( tags[i] ) );
		}

		return results;
	};

	var _user = function(user) {
		return {
			id: _graphID(user.self),
			photo: user.data.photo || '',
			username: user.data.username || ''
		};
	};

	var _users = function(users) {
		var i,
			j,
			results = [];
		
		for(i=0, j=users.length; i<j; i++){
			results.push( _user( users[i] ) );
		}

		return results;
	};

	return {
		adventureNode : _adventureNode,
		userNode : _userNode,
		tagNode : _tagNode,
		adventures : _adventures,
		comment : _comment,
		comments: _comments,
		graphID : _graphID,
		like: _like,
		likes: _likes,
		moment: _moment,
		moments: _moments,
		tag: _tag,
		tags: _tags,
		user : _user,
		users: _users
	};
};

module.exports = Format;